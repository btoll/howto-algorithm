#define _XOPEN_SOURCE
#include <unistd.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// Example usage:
//
//      gcc simple_cracker.c -lcrypt
//      ./a.out /usr/share/dict/words yyvTPP5FP4CiE
//
int main(int argc, char *argv[]) {
    FILE *wordlist;
    char *word, *hashed;
    char salt[3], buf[50];

    if (argc < 3) {
        printf("Usage: %s <wordlist> <password hash>\n", argv[0]);
        exit(1);
    }

    if ((wordlist = fopen(argv[1], "r")) == NULL) {
        printf("Could not open file\n");
        exit(1);
    }

    // Extract the salt.
    strncpy(salt, argv[2], 2);
    salt[2] = '\0';

    while ((word = fgets(buf, 50, wordlist)) != '\0') {
        // Remove \n at the end.
        word[strlen(word) - 1] = '\0';

        hashed = crypt(word, salt);

        if (strcmp(hashed, argv[2]) == 0) {
            printf("Cracked password is \"%s\"\n", word);
            fclose(wordlist);
            exit(0);
        }
    }

    printf("No matches\n");
    fclose(wordlist);

    return 0;
}

